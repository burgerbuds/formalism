// ================================
// Search Outlined
// Requires: search/base.scss
// ================================

// Imports
@import './../common/core';
@import './../common/outlined';

// Variables > Button
$fo-search--button-width-base: 3.5em; // Non-configurable min width
$fo-search--button-width-additional: 0em !default;
$fo-search--button-scale-active: 0.9 !default;
$fo-search--button-color: $f-border-color !default;
$fo-search--button-color-hover: $f-highlight-color !default;
$fo-search--button-color-focus: $f-highlight-color !default;
$fo-search--button-color-active: $f-highlight-color !default;

// Variables > Icons
$fo-search--icon-size: 1.5em !default;
$fo-search--icon-max-height: 45% !default;
$fo-search--icon-stroke-width: 3px !default;
$fo-search--icon-position: 0em, 0em !default; // translate(x, y) fine tuning
$fo-search--cancel-stroke-width: 4px !default;

// Variables > Protected
$fo-button-width: calc(
    #{$fo-search--button-width-base} + #{$fo-search--button-width-additional}
);

// Mixins

@include fo-field('.f-search');

@include f-field(
    $block: '.f-search',
    $theme: 'outlined',
) {
    padding-right: $fo-button-width;
    -webkit-appearance: none;
    appearance: none;
}

@include fo-label('.f-search') {
    top: 0;
    bottom: 0;
    left: calc(#{$f-border-width} + #{$fo-field-padding-left});
}

// Theme
.f-search--outlined {
    $block: '.f-search';

    @include fo-label-text($block);

    #{$block}__button {
        // Reset
        -webkit-appearance: none;
        appearance: none;
        border: 0;
        padding: 0;
        // outline: 0;
        font-size: $f-text-font-size;
        background-color: transparent;

        // Alignment
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: -.15em; // Visual realignment

        // Positioning
        position: absolute;
        top: calc(#{$fo-field-padding-top} + #{$f-border-width});
        right: $f-border-width;

        // Misc
        color: $fo-search--button-color;
        width: $fo-button-width;
        transition: transition(background-color), transition(transform), transition(color);
        will-change: background-color, transform, color;
        transform-origin: 50%;

        &:not(:disabled):hover,
        &:not(:disabled):focus {
            cursor: pointer;
        }

        &:hover {
            color: $fo-search--button-color-hover;
        }

        &:focus {
            outline: 0;
            color: $fo-search--button-color-focus;
        }

        &:active {
            color: $fo-search--button-color-active;
            transform: translateZ(0) scale(#{$fo-search--button-scale-active});
        }

        &:disabled {
            color: $f-disabled-color;
            user-select: none;
        }

        &--search-icon svg {
            width: 1em;
            height: 1em;
            pointer-events: none;
            max-height: $fo-search--icon-max-height;
            font-size: $fo-search--icon-size;
            transform: translate($fo-search--icon-position);

            * {
                stroke-width: $fo-search--icon-stroke-width;
            }
        }
    }

    &#{$f-modifier-error} #{$block}__button:focus {
        color: $f-border-color-error;
    }

    // Cancel button
    $button-color: str-replace(
        #{inspect($fo-search--button-color)},
        '#',
        '%23'
    );
    ::-webkit-search-cancel-button {
        -webkit-appearance: none;
        transform: translateZ(0);
        height: 1.5em;
        width: 1em;
        cursor: pointer;
        margin-left: 0.75em;
        transition: transition(background-color), transition(transform);
        will-change: background-color, transform;
        transform-origin: 50%;
        background: url("data:image/svg+xml,%3Csvg viewBox='0 0 27.707 27.707' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='.854' x2='26.854' y1='.854' y2='26.854' stroke='#{$button-color}' stroke-width='#{$fo-search--cancel-stroke-width}'/%3E%3Cline x1='.854' x2='26.854' y1='26.854' y2='.854' stroke='#{$button-color}' stroke-width='#{$fo-search--cancel-stroke-width}'/%3E%3C/svg%3E%0A")
            no-repeat 50%;
        background-size: 90%;
    }

    // Cancel button > Hover
    $button-color: str-replace(
        #{inspect($fo-search--button-color-hover)},
        '#',
        '%23'
    );
    ::-webkit-search-cancel-button:hover {
        background: url("data:image/svg+xml,%3Csvg viewBox='0 0 27.707 27.707' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='.854' x2='26.854' y1='.854' y2='26.854' stroke='#{$button-color}' stroke-width='#{$fo-search--cancel-stroke-width}'/%3E%3Cline x1='.854' x2='26.854' y1='26.854' y2='.854' stroke='#{$button-color}' stroke-width='#{$fo-search--cancel-stroke-width}'/%3E%3C/svg%3E%0A")
            no-repeat 50%;
        background-size: 90%;
    }

    // Cancel button > Active
    ::-webkit-search-cancel-button:active {
        color: $fo-search--button-color-active;
        transform: translateZ(0) scale(#{$fo-search--button-scale-active});
    }

    @include fo-indicator($block);
    @include fo-message($block) {
        margin: $fo-message-margin-inset;
    }
}
